#!/bin/ansible-playbook
- name: MSIO | Ensign | Terraform Deploy
  hosts: localhost
  vars_files:
    - vars/custom.yml
    - vars/main.yml
  tasks:
    - name: MSIO | Ensign | Detect RunAs User
      become: false
      local_action: command whoami
      register: ansible_user_connected

    - name: MSIO | Ensign | purge known_hosts
      lineinfile:
        path: "/home/{{ ansible_user_connected }}/.ssh/known_hosts"
        regexp: 'ensign'
        state: absent

    - terraform:
        project_path: 'tf/instance/'
        state: present
        force_init: true
